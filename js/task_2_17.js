"use strict";function getDateStr(a){var t=a.getFullYear(),e=a.getMonth()+1;e=10>e?"0"+e:e;var r=a.getDate();return r=10>r?"0"+r:r,t+"-"+e+"-"+r}function randomBuildData(a){for(var t={},e=new Date("2016-01-01"),r="",n=1;150>n;n++)r=getDateStr(e),t[r]=Math.ceil(Math.random()*a),e.setDate(e.getDate()+1);return t}function renderChart(){initAqiChartData();var a=chartData.length,t=600,e=500,r=500,n=e/a,i=0;$$("#aqi-chart-wrap")[0].innerHTML=null;for(var o in chartData.data)if(chartData.data.hasOwnProperty(o)){var c=chartData.data[o]/t*r,l=document.createElement("div");l.style.height=c+"px",l.style.width=n+"px",l.style.left=n*i++ +"px",l.style.backgroundColor=getColorByAqi(chartData.data[o]),$$("#aqi-chart-wrap")[0].appendChild(l)}}function getColorByAqi(a){return a>300?"#ac0401":a>200?"#ff4404":a>150?"#f09837":a>100?"#75bf42":a>50?"#76c0ef":"#0289c3"}function graTimeChange(){var a,t=document.getElementsByName("gra-time");for(var e in t)t.hasOwnProperty(e)&&t[e].checked===!0&&(a=t[e].value);pageState.nowGraTime=a,renderChart()}function citySelectChange(){var a=$$("#city-select")[0],t=a.selectedIndex;a.getElementsByTagName("option");pageState.nowSelectCity=t,renderChart()}function initGraTimeForm(){var a=document.getElementsByName("gra-time");for(var t in a)a.hasOwnProperty(t)&&(a[t].onclick=graTimeChange)}function initCitySelector(){var a=$$("#city-select")[0],t=0;for(var e in aqiSourceData)if(aqiSourceData.hasOwnProperty(e)){var r=document.createElement("option");r.innerHTML=e,cityMap[t++]=e,a.appendChild(r)}a.onchange=citySelectChange}function initAqiChartData(){var a=cityMap[pageState.nowSelectCity],t=pageState.nowGraTime,e=aqiSourceData[a],r=0;if(chartData.data={},chartData.length=r,"day"===t)for(var n in e)e.hasOwnProperty(n)&&(chartData.data[r++]=e[n],chartData.length=r);else if("month"===t){var i={};for(var n in e)if(e.hasOwnProperty(n)){var o=parseInt(n.split("-")[0]),c=parseInt(n.split("-")[1]),l=parseInt(n.split("-")[2]);1===l?(void 0===i[o]&&(i[o]={}),i[o][c]={},i[o][c].total=0+e[n],i[o][c].len=1):(i[o][c].total+=e[n],i[o][c].len++)}for(var h in i)for(var d in i[h])chartData.data[r++]=i[h][d].total/i[h][d].len,chartData.length=r}else{var i={},u=0,p=0,r=0,D=!0;for(var n in e)if(e.hasOwnProperty(n)){var f,m=parseInt(n.split("-")[0]),s=parseInt(n.split("-")[1]),y=parseInt(n.split("-")[2]);D?(f=calWeekDay(m,s,y),D=!1):f=(f+1)%7,p++,u+=e[n],0===f&&(chartData.data[r++]=u/p,chartData.length=r,u=0,p=0)}}}function calWeekDay(a,t,e){var r=[0,3,2,5,0,3,5,1,4,6,2,4];return a-=3>t,(a+Math.floor(a/4)-Math.floor(a/100)+Math.floor(a/400)+r[t-1]+e)%7}function init(){initGraTimeForm(),initCitySelector(),initAqiChartData(),renderChart()}var $$=function(a,t){t=t||document;var e=t.querySelectorAll(a);return Array.prototype.slice.call(e)},aqiSourceData={"北京":randomBuildData(500),"上海":randomBuildData(300),"广州":randomBuildData(200),"深圳":randomBuildData(100),"成都":randomBuildData(300),"西安":randomBuildData(500),"福州":randomBuildData(100),"厦门":randomBuildData(100),"沈阳":randomBuildData(500)},cityMap={},chartData={data:{}},pageState={nowSelectCity:0,nowGraTime:"day"};init();